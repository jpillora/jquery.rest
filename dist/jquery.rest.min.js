/*! jQuery REST Client - v0.0.3 - 2013-02-02
* https://github.com/jpillora/jquery.rest
* Copyright (c) 2013 Jaime Pillora; Licensed MIT */
(function(){"use strict";var e,t,n,r,i,s,o,u,a,f,l;s=function(e){throw"ERROR: jquery.rest: "+e},u=function(e){var t;t="";while(e-->0)t+="  ";return t},i=function(e){return window.btoa||s("You need a polyfill for 'btoa' to use basic auth."),window.btoa(e)},a=function(e){return window.JSON||s("You need a polyfill for 'JSON' to use stringify."),window.JSON.stringify(e)},o=function(e,t){var n;return n=function(){},n.prototype=e,$.extend(!0,new n,t)},f=function(e){return!e||!$.isPlainObject(e)?!1:($.each(e,function(e){if(r[e]===undefined)return s("Unknown option: '"+e+"'")}),null)},l=function(e,t){if("string"!==$.type(t))return s("'"+e+"' must be a string")},r={url:"",cache:0,cachableMethods:["GET"],stringifyData:!1,password:null,username:null,verbs:{create:"POST",read:"GET",update:"PUT","delete":"DELETE"},ajax:{dataType:"json"}},e=function(){function e(e){this.parent=e,this.c={}}return e.prototype.valid=function(e){var t;return t=(new Date).getTime()-e.getTime(),t<=this.parent.opts.cache*1e3},e.prototype.key=function(e){var t,n=this;return t="",$.each(e,function(e,r){return t+=e+"="+($.isPlainObject(r)?"{"+n.key(r)+"}":r)+"|"}),t},e.prototype.get=function(e){var t;t=this.c[e];if(!t)return;if(this.valid(t.created))return t.data},e.prototype.put=function(e,t){return this.c[e]={created:new Date,data:t}},e.prototype.clear=function(e){var t=this;return e?$.each(this.c,function(n){if(n.match(e))return delete t.c[n]}):this.c={}},e}(),n=function(){function e(e,t,n,i){this.name=e,this.method=t,n==null&&(n={}),this.parent=i,l("name",this.name),l("method",this.method),f(n),this.parent[this.name]&&s("Cannot add Verb: '"+e+"' already exists"),this.method=t.toUpperCase(),n.url||(n.url=""),this.opts=o(this.parent.opts,n),this.root=this.parent.root,this.custom=!r.verbs[this.name],this.call=$.proxy(this.call,this),this.call.instance=this}return e.prototype.call=function(){var e;return e=this.parent.extractUrlData(this.method,arguments),this.custom&&(e.url+=this.opts.url||this.name),this.parent.ajax.call(this,this.method,e.url,e.data)},e.prototype.show=function(e){return console.log(u(e)+this.name+": "+this.method)},e}(),t=function(){function t(e,n,r){n==null&&(n={}),f(n),r&&r instanceof t?(this.name=e,l("name",this.name),this.constructChild(r,n)):(this.url=e||"",l("url",this.url),this.constructRoot(n))}return t.prototype.constructRoot=function(t){return this.opts=o(r,t),this.root=this,this.numParents=0,this.urlNoId=this.url,this.cache=new e(this),this.parent=null,this.name=this.opts.name||"ROOT"},t.prototype.constructChild=function(e,n){this.parent=e,l("name",this.name),this.parent instanceof t||this.error("Invalid parent"),this.parent[this.name]&&this.error("'"+name+"' already exists"),n.url||(n.url=""),this.opts=o(this.parent.opts,n),this.root=this.parent.root,this.numParents=this.parent.numParents+1,this.urlNoId=this.parent.url+(""+(this.opts.url||this.name)+"/"),this.url=this.urlNoId+(":ID_"+this.numParents+"/"),$.each(this.opts.verbs,$.proxy(this.addVerb,this));if(this["delete"])return this.del=this["delete"]},t.prototype.error=function(e){return s("Cannot add Resource: "+e)},t.prototype.add=function(e,n){return this[e]=new t(e,n,this)},t.prototype.addVerb=function(e,t,r){return this[e]=(new n(e,t,r,this)).call},t.prototype.show=function(e){var r=this;return e==null&&(e=0),e>25&&s("Plugin Bug! Recurrsion Fail"),this.name&&console.log(u(e)+this.name+": "+this.url),$.each(this,function(t,r){if($.type(r)==="function"&&r.instance instanceof n&&t!=="del")return r.instance.show(e+1)}),$.each(this,function(n,r){if(n!=="parent"&&n!=="root"&&r instanceof t)return r.show(e+1)}),null},t.prototype.toString=function(){return this.name},t.prototype.extractUrlData=function(e,t){var n,r,i,o,u,a,f,l,c,h,p,d,v,m,g;f=[],o=null;for(d=0,m=t.length;d<m;d++)n=t[d],h=$.type(n),h==="string"||h==="number"?f.push(n):$.isPlainObject(n)&&o===null?o=n:s("Invalid argument: "+n+" ("+h+")."+" Must be strings or ints (IDs) followed by one optional plain object (data).");c=f.length,r=e!=="create",i=e!=="update"&&e!=="delete",p=null,r&&c===this.numParents&&(p=this.url),i&&c===this.numParents-1&&(p=this.urlNoId),p===null&&(i&&(l=this.numParents-1),r&&(l=(l?l+" or ":"")+this.numParents),s("Invalid number of ID arguments, required "+l+", provided "+c));for(u=v=0,g=f.length;v<g;u=++v)a=f[u],p=p.replace(new RegExp("/:ID_"+(u+1)+"/"),"/"+a+"/");return{url:p,data:o}},t.prototype.ajax=function(e,t,n,r){var o,u,f,l,c,h=this;r==null&&(r={}),e||s("method missing"),t||s("url missing"),this.opts.username&&this.opts.password&&(u=i(this.opts.username+":"+this.opts.password),r.Authorization="Basic "+u),n&&this.opts.stringifyData&&(n=a(n)),o={url:t,type:e,headers:r},n&&(o.data=n),o=$.extend(!0,{},this.opts.ajax,o),c=this.opts.cache&&$.inArray(e,this.opts.cachableMethods)>=0,o.foo=42;if(c){f=this.root.cache.key(o),l=this.root.cache.get(f);if(l)return l}return l=$.ajax(o),c&&l.done(function(e,t,n,r){return h.root.cache.put(f,l)}),l},t}(),t.defaults=r,$.RestClient=t}).call(this);